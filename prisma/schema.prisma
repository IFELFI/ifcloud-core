generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["file", "member", "public"]
}

model file {
  id                                            BigInt         @id(map: "pk_file") @default(autoincrement())
  file_key                                      String         @unique(map: "uni_file_file_key") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type                                          file_type      @default(block)
  file_name                                     String         @db.VarChar(256)
  owner_id                                      Int
  member                                        member         @relation(fields: [owner_id], references: [id], onDelete: Cascade, map: "fk_owner_id")
  file_closure_file_closure_ancestor_idTofile   file_closure[] @relation("file_closure_ancestor_idTofile")
  file_closure_file_closure_descendant_idTofile file_closure[] @relation("file_closure_descendant_idTofile")
  file_info                                     file_info?
  file_role                                     file_role[]

  @@schema("file")
}

model file_info {
  file_id     BigInt   @id(map: "pk_file_info")
  create_date DateTime @default(now()) @db.Timestamptz(6)
  update_date DateTime @default(now()) @db.Timestamptz(6)
  byte_size   Int      @default(0)
  file        file     @relation(fields: [file_id], references: [id], onDelete: Cascade, map: "fk_file_id")

  @@schema("file")
}

model file_role {
  member_id Int
  file_id   BigInt
  role      access_role[] @default([])
  file      file          @relation(fields: [file_id], references: [id], onDelete: Cascade, map: "fk_file_id")
  member    member        @relation(fields: [member_id], references: [id], onDelete: Cascade, map: "fk_member_id")

  @@id([member_id, file_id], map: "pk_file_role")
  @@schema("file")
}

model member {
  id             Int             @id(map: "pk_member") @default(autoincrement())
  uuid_key       String          @unique(map: "uni_member_uuid_key") @db.Uuid
  file           file[]
  file_role      file_role[]
  service_status service_status?

  @@schema("member")
}

model service_status {
  member_id   Int      @id(map: "pk_service_status")
  available   Boolean  @default(false)
  join_date   DateTime @default(now()) @db.Timestamptz(6)
  update_date DateTime @default(now()) @db.Timestamptz(6)
  member      member   @relation(fields: [member_id], references: [id], onDelete: Cascade, map: "fk_member_id")

  @@schema("member")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model file_closure {
  ancestor_id                           BigInt
  descendant_id                         BigInt
  depth                                 Int    @db.SmallInt
  file_file_closure_ancestor_idTofile   file   @relation("file_closure_ancestor_idTofile", fields: [ancestor_id], references: [id], onDelete: Cascade, map: "fk_ancestor_id")
  file_file_closure_descendant_idTofile file   @relation("file_closure_descendant_idTofile", fields: [descendant_id], references: [id], onDelete: Cascade, map: "fk_descendant_id")

  @@id([ancestor_id, descendant_id], map: "pk_file_closure")
  @@schema("file")
}

enum access_role {
  create
  read
  update
  delete

  @@schema("public")
}

enum file_type {
  container
  block
  link

  @@schema("public")
}
